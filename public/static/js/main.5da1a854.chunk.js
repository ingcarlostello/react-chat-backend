(this["webpackJsonpchat-app"]=this["webpackJsonpchat-app"]||[]).push([[0],{124:function(e,t,n){},125:function(e,t,n){},126:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n(1),s=n(29),r=n.n(s),i=n(16),o=n(3),l=n(4),u=n.n(l),j=n(7),m=n(19),d=n(2),b=n(6),h=n(31),O=n.n(h),p=n(33),x="[chat] users loaded",f="[chat] active a user chat",v="[chat] new message",g="[chat] load messages",N="[chat] clean the chat",k=function(e,t){switch(t.type){case x:return Object(d.a)(Object(d.a)({},e),{},{allUsers:Object(p.a)(t.payload)});case f:return e.userActiveChat===t.payload?e:Object(d.a)(Object(d.a)({},e),{},{userActiveChat:t.payload});case v:return e.userActiveChat===t.payload.from||e.userActiveChat===t.payload.toWho?Object(d.a)(Object(d.a)({},e),{},{messages:[].concat(Object(p.a)(e.messages),[t.payload])}):e;case g:return Object(d.a)(Object(d.a)({},e),{},{messages:Object(p.a)(t.payload)});case N:return{uid:"",userActiveChat:null,allUsers:[],messages:[]};default:return e}},w=Object(c.createContext)(),C={uid:"",userActiveChat:null,allUsers:[],messages:[]},y=function(e){var t=e.children,n=Object(c.useReducer)(k,C),s=Object(b.a)(n,2),r=s[0],i=s[1];return Object(a.jsx)(w.Provider,{value:{chatState:r,dispatch:i},children:t})},S=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_API_URL,_=function(){var e=Object(j.a)(u.a.mark((function e(t,n){var a,c,s,r,i=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=i.length>2&&void 0!==i[2]?i[2]:"GET",c="".concat(S,"/").concat(t),"GET"!==a){e.next=11;break}return e.next=5,fetch(c);case 5:return s=e.sent,e.next=8,s.json();case 8:return e.abrupt("return",e.sent);case 11:return e.next=13,fetch(c,{method:a,headers:{"Content-type":"application/json"},body:JSON.stringify(n)});case 13:return r=e.sent,e.abrupt("return",r.json());case 15:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),E=function(){var e=Object(j.a)(u.a.mark((function e(t,n){var a,c,s,r,i,o=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=o.length>2&&void 0!==o[2]?o[2]:"GET",c="".concat(S,"/").concat(t),s=localStorage.getItem("token")||"","GET"!==a){e.next=12;break}return e.next=6,fetch(c,{headers:{"x-token":s}});case 6:return r=e.sent,e.next=9,r.json();case 9:return e.abrupt("return",e.sent);case 12:return e.next=14,fetch(c,{method:a,headers:{"Content-type":"application/json","x-token":s},body:JSON.stringify(n)});case 14:return i=e.sent,e.abrupt("return",i.json());case 16:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),A=Object(c.createContext)(),T={uid:null,checking:!0,logged:!1,name:null,email:null},I=function(e){var t=e.children,n=Object(c.useState)(T),s=Object(b.a)(n,2),r=s[0],i=s[1],o=Object(c.useContext)(w).dispatch,l=function(){var e=Object(j.a)(u.a.mark((function e(t,n){var a,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_("login",{email:t,password:n},"POST");case 2:return a=e.sent,console.log(a),a.ok&&(localStorage.setItem("token",a.token),c=a.user,i({uid:c.uid,checking:!1,logged:!0,name:c.name,email:c.email})),e.abrupt("return",a.ok);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),m=function(){var e=Object(j.a)(u.a.mark((function e(t,n,a){var c,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_("login/new",{name:t,email:n,password:a},"POST");case 2:return(c=e.sent).ok&&(localStorage.setItem("token",c.token),s=c.userChat,i({uid:s.uid,checking:!1,logged:!0,name:s.name,email:s.email})),e.abrupt("return",c.ok);case 5:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),d=Object(c.useCallback)(Object(j.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(localStorage.getItem("token")){e.next=4;break}return i({uid:null,checking:!1,logged:!1,name:null,email:null}),e.abrupt("return",!1);case 4:return e.next=6,E("login/renew");case 6:if(!(t=e.sent).ok){e.next=15;break}return localStorage.setItem("token",t.token),n=t.user,i({uid:n.uid,checking:!1,logged:!0,name:n.name,email:n.email}),console.log("Successfully authenticated "),e.abrupt("return",!0);case 15:return i({uid:null,checking:!1,logged:!1,name:null,email:null}),e.abrupt("return",!1);case 17:case"end":return e.stop()}}),e)}))),[]);return Object(a.jsx)(A.Provider,{value:{auth:r,login:l,logout:function(){localStorage.removeItem("token"),o({type:N}),i({checking:!1,logged:!1})},register:m,verifyToken:d},children:t})},P=function(){var e=Object(c.useContext)(A).login,t=Object(c.useState)({email:"",password:"",rememberme:!1}),n=Object(b.a)(t,2),s=n[0],r=n[1];Object(c.useEffect)((function(){var e=localStorage.getItem("email");e&&r((function(t){return Object(d.a)(Object(d.a)({},t),{},{rememberme:!0,email:e})}))}),[]);var o=function(e){var t=e.target,n=t.name,a=t.value;r(Object(d.a)(Object(d.a)({},s),{},Object(m.a)({},n,a)))},l=function(){var t=Object(j.a)(u.a.mark((function t(n){var a,c;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),s.rememberme?localStorage.setItem("email",s.email):localStorage.removeItem("email"),a=s.email,c=s.password,t.next=5,e(a,c);case 5:t.sent||O.a.fire("Error","Check email and password","error");case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(a.jsxs)("form",{className:"login100-form validate-form flex-sb flex-w",onSubmit:l,children:[Object(a.jsx)("span",{className:"login100-form-title mb-3",children:"Chat - Enter"}),Object(a.jsxs)("div",{className:"wrap-input100 validate-input mb-3",children:[Object(a.jsx)("input",{className:"input100",name:"email",placeholder:"Email",type:"email",value:s.email,onChange:o}),Object(a.jsx)("span",{className:"focus-input100"})]}),Object(a.jsxs)("div",{className:"wrap-input100 validate-input mb-3",children:[Object(a.jsx)("input",{className:"input100",name:"password",placeholder:"Password",type:"password",value:s.password,onChange:o}),Object(a.jsx)("span",{className:"focus-input100"})]}),Object(a.jsxs)("div",{className:"row mb-3",children:[Object(a.jsxs)("div",{className:"col",onClick:function(){r(Object(d.a)(Object(d.a)({},s),{},{rememberme:!s.rememberme}))},children:[Object(a.jsx)("input",{className:"input-checkbox100",id:"ckb1",type:"checkbox",name:"rememberme",checked:s.rememberme,readOnly:!0}),Object(a.jsx)("label",{className:"label-checkbox100",children:"Remember me"})]}),Object(a.jsx)("div",{className:"col text-right",children:Object(a.jsx)(i.b,{to:"/auth/register",className:"txt1",children:"New account?"})})]}),Object(a.jsx)("div",{className:"container-login100-form-btn m-t-17",children:Object(a.jsx)("button",{className:"login100-form-btn",type:"submit",disabled:!(s.email.length>0&&s.password.length>0),children:"Login"})})]})},D=function(){var e=Object(c.useContext)(A).register,t=Object(c.useState)({name:"",email:"",password:""}),n=Object(b.a)(t,2),s=n[0],r=n[1],o=function(e){var t=e.target,n=t.name,a=t.value;r(Object(d.a)(Object(d.a)({},s),{},Object(m.a)({},n,a)))},l=function(){var t=Object(j.a)(u.a.mark((function t(n){var a,c,r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),a=s.name,c=s.email,r=s.password,t.next=4,e(a,c,r);case 4:t.sent||O.a.fire("Error","There is an account with this email","error");case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(a.jsxs)("form",{className:"login100-form validate-form flex-sb flex-w",onSubmit:l,children:[Object(a.jsx)("span",{className:"login100-form-title mb-3",children:"Chat - Register"}),Object(a.jsxs)("div",{className:"wrap-input100 validate-input mb-3",children:[Object(a.jsx)("input",{className:"input100",name:"name",onChange:o,placeholder:"Name",type:"text",value:s.name}),Object(a.jsx)("span",{className:"focus-input100"})]}),Object(a.jsxs)("div",{className:"wrap-input100 validate-input mb-3",children:[Object(a.jsx)("input",{className:"input100",name:"email",onChange:o,placeholder:"Email",type:"email",value:s.email}),Object(a.jsx)("span",{className:"focus-input100"})]}),Object(a.jsxs)("div",{className:"wrap-input100 validate-input mb-3",children:[Object(a.jsx)("input",{className:"input100",type:"password",name:"password",placeholder:"Password",value:s.password,onChange:o}),Object(a.jsx)("span",{className:"focus-input100"})]}),Object(a.jsx)("div",{className:"row mb-3",children:Object(a.jsx)("div",{className:"col text-right",children:Object(a.jsx)(i.b,{to:"/auth/login",className:"txt1",children:"Do you already have an account?"})})}),Object(a.jsx)("div",{className:"container-login100-form-btn m-t-17",children:Object(a.jsx)("button",{className:"login100-form-btn",type:"submit",disabled:!(s.email.length>0&&s.password.length>0&&s.name.length>0),children:"Create Account"})})]})},R=(n(90),function(){return Object(a.jsx)("div",{className:"limiter",children:Object(a.jsx)("div",{className:"container-login100",children:Object(a.jsx)("div",{className:"wrap-login100 p-t-50 p-b-90",children:Object(a.jsxs)(o.d,{children:[Object(a.jsx)(o.b,{exact:!0,path:"/auth/login",component:P}),Object(a.jsx)(o.b,{exact:!0,path:"/auth/register",component:D}),Object(a.jsx)(o.a,{to:"/auth/login"})]})})})})}),U=n(32),W=function(e){var t=e.isAuthenticated,n=e.component,c=Object(U.a)(e,["isAuthenticated","component"]);return Object(a.jsx)(o.b,Object(d.a)(Object(d.a)({},c),{},{component:function(e){return t?Object(a.jsx)(n,Object(d.a)({},e)):Object(a.jsx)(o.a,{to:"/auth"})}}))},H=function(e){var t=e.isAuthenticated,n=e.component,c=Object(U.a)(e,["isAuthenticated","component"]);return Object(a.jsx)(o.b,Object(d.a)(Object(d.a)({},c),{},{component:function(e){return t?Object(a.jsx)(o.a,{to:"/"}):Object(a.jsx)(n,Object(d.a)({},e))}}))},B=function(){return Object(a.jsx)("div",{className:"middle-screen",children:Object(a.jsxs)("div",{className:"alert-info",children:[Object(a.jsx)("hr",{}),Object(a.jsx)("h3",{children:"Seleccione una persona"}),Object(a.jsx)("span",{children:"Para comenzar una conversaci\xf3n"})]})})},G=function(){var e=Object(c.useContext)(A),t=e.auth,n=e.logout;return Object(a.jsxs)("div",{className:"headind_srch",children:[Object(a.jsx)("div",{className:"recent_heading mt-2",children:Object(a.jsx)("h4",{children:t.name})}),Object(a.jsx)("div",{className:"srch_bar",children:Object(a.jsx)("div",{className:"stylish-input-group",children:Object(a.jsx)("button",{className:"btn text-danger",onClick:n,children:"Exit"})})})]})},J=n(49),L=function(e){var t=e.userName,n=Object(c.useContext)(w),s=n.dispatch,r=n.chatState,i=function(){var e=Object(j.a)(u.a.mark((function e(){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s({type:f,payload:t.uid}),e.next=3,E("messages/".concat(t.uid));case 3:n=e.sent,s({type:g,payload:n.messages}),a="div-messages",J.animateScroll.scrollToBottom({containerId:a,duration:0});case 6:case"end":return e.stop()}var a}),e)})));return function(){return e.apply(this,arguments)}}();return Object(a.jsx)("div",{className:"chat_list ".concat(t.uid===r.userActiveChat&&" active_chat"),onClick:i,children:Object(a.jsxs)("div",{className:"chat_people",children:[Object(a.jsx)("div",{className:"chat_img",children:Object(a.jsx)("img",{src:"https://www.pngkey.com/png/detail/114-1149878_setting-user-avatar-in-specific-size-without-breaking.png",alt:"sunil"})}),Object(a.jsxs)("div",{className:"chat_ib",children:[Object(a.jsx)("h5",{children:t.name}),t.online?Object(a.jsx)("span",{className:"text-success",children:"Online"}):Object(a.jsx)("span",{className:"text-danger",children:"Offline"})]})]})})},M=function(){var e=Object(c.useContext)(A).auth,t=Object(c.useContext)(w).chatState,n=e.uid;return Object(a.jsxs)("div",{className:"inbox_chat",children:[t.allUsers.filter((function(e){return e.uid!==n})).map((function(e){return Object(a.jsx)(L,{userName:e},e.uid)})),Object(a.jsx)("div",{className:"extra_space"})]})},K=function(){return Object(a.jsxs)("div",{className:"inbox_people",children:[Object(a.jsx)(G,{}),Object(a.jsx)(M,{})]})},z=n(71),F=n.n(z),q=function(e){return F()(e).format("HH:mm a | MMM Do")},V=function(e){var t=e.msg;return Object(a.jsxs)("div",{className:"incoming_msg",children:[Object(a.jsx)("div",{className:"incoming_msg_img",children:Object(a.jsx)("img",{src:"https://ptetutorials.com/images/user-profile.png",alt:"sunil"})}),Object(a.jsx)("div",{className:"received_msg",children:Object(a.jsxs)("div",{className:"received_withd_msg",children:[Object(a.jsx)("p",{children:t.message}),Object(a.jsx)("span",{className:"time_date",children:q(t.createdAt)})]})})]})},Q=function(e){var t=e.msg;return Object(a.jsx)("div",{className:"outgoing_msg",children:Object(a.jsxs)("div",{className:"sent_msg",children:[Object(a.jsx)("p",{children:t.message}),Object(a.jsx)("span",{className:"time_date",children:q(t.createdAt)})]})})},X=n(72),Y=n.n(X),Z=Object(c.createContext)(),$=function(e){var t=e.children,n=function(e){var t=Object(c.useState)(null),n=Object(b.a)(t,2),a=n[0],s=n[1],r=Object(c.useState)(!1),i=Object(b.a)(r,2),o=i[0],l=i[1],u=Object(c.useCallback)((function(){var t=localStorage.getItem("token"),n=Y.a.connect(e,{transports:["websocket"],autoConnect:!0,forceNew:!0,query:{"x-token":t}});s(n)}),[e]),j=Object(c.useCallback)((function(){null===a||void 0===a||a.disconnect()}),[a]);return Object(c.useEffect)((function(){l(null===a||void 0===a?void 0:a.connected)}),[a]),Object(c.useEffect)((function(){null===a||void 0===a||a.on("connect",(function(){return l(!0)}))}),[a]),Object(c.useEffect)((function(){null===a||void 0===a||a.on("disconnect",(function(){return l(!1)}))}),[a]),{connectSocket:u,disconnectSocket:j,online:o,socket:a}}("http://localhost:8080"),s=n.socket,r=n.online,i=n.connectSocket,o=n.disconnectSocket,l=Object(c.useContext)(A).auth,u=Object(c.useContext)(w).dispatch;return Object(c.useEffect)((function(){l.logged&&i()}),[l,i]),Object(c.useEffect)((function(){l.logged||o()}),[l,o]),Object(c.useEffect)((function(){null===s||void 0===s||s.on("list-users",(function(e){u({type:x,payload:e})}))}),[s,u]),Object(c.useEffect)((function(){null===s||void 0===s||s.on("private-message",(function(e){var t;u({type:v,payload:e}),t="div-messages",J.animateScroll.scrollToBottom({containerId:t,duration:300})}))}),[s,u]),Object(a.jsx)(Z.Provider,{value:{socket:s,online:r},children:t})},ee=function(){var e=Object(c.useState)(""),t=Object(b.a)(e,2),n=t[0],s=t[1],r=Object(c.useContext)(A).auth,i=Object(c.useContext)(w).chatState,o=Object(c.useContext)(Z).socket;return Object(a.jsx)("form",{onSubmit:function(e){e.preventDefault(),0!==n.length&&(s(""),o.emit("private-message",{from:r.uid,toWho:i.userActiveChat,message:n}))},children:Object(a.jsxs)("div",{className:"type_msg row",children:[Object(a.jsx)("div",{className:"input_msg_write col-sm-9",children:Object(a.jsx)("input",{type:"text",className:"write_msg",placeholder:"Mensaje...",value:n,onChange:function(e){var t=e.target;s(t.value)}})}),Object(a.jsx)("div",{className:"col-sm-3 text-center",children:Object(a.jsx)("button",{className:"msg_send_btn mt-3",type:"submit",children:"enviar"})})]})})},te=function(){var e=Object(c.useContext)(A).auth,t=Object(c.useContext)(w).chatState;return Object(a.jsxs)("div",{className:"mesgs",children:[Object(a.jsx)("div",{id:"div-messages",className:"msg_history",children:t.messages.map((function(t){return t.toWho===e.uid?Object(a.jsx)(V,{msg:t},t._id):Object(a.jsx)(Q,{msg:t},t._id)}))}),Object(a.jsx)(ee,{})]})},ne=(n(124),function(){var e=Object(c.useContext)(w).chatState;return Object(a.jsx)("div",{className:"messaging",children:Object(a.jsxs)("div",{className:"inbox_msg",children:[Object(a.jsx)(K,{}),e.userActiveChat?Object(a.jsx)(te,{}):Object(a.jsx)(B,{})]})})}),ae=function(){var e=Object(c.useContext)(A),t=e.auth,n=e.verifyToken;return Object(c.useEffect)((function(){n()}),[n]),t.checking?Object(a.jsx)("h1",{children:"Wait a moment"}):Object(a.jsx)(i.a,{children:Object(a.jsx)("div",{children:Object(a.jsxs)(o.d,{children:[Object(a.jsx)(H,{isAuthenticated:t.logged,path:"/auth",component:R}),Object(a.jsx)(W,{isAuthenticated:t.logged,exact:!0,path:"/",component:ne}),Object(a.jsx)(o.a,{to:"/"})]})})})},ce=function(){return Object(a.jsx)(y,{children:Object(a.jsx)(I,{children:Object(a.jsx)($,{children:Object(a.jsx)(ae,{})})})})};n(125);r.a.render(Object(a.jsx)(ce,{}),document.getElementById("root"))},90:function(e,t,n){}},[[126,1,2]]]);
//# sourceMappingURL=main.5da1a854.chunk.js.map